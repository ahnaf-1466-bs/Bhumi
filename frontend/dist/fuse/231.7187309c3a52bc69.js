"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[231],{8231:(R,h,n)=>{n.r(h),n.d(h,{VideoActivityModule:()=>Y});var p=n(6895),b=n(4006),m=n(7392),A=n(266),d=n(9197),t=n(4650),I=n(8255),D=n(7477),_=n(4512),T=n(51),C=n(8951),y=n(2340),f=n(3900),x=n(9646),w=n(529);let V=(()=>{class o{constructor(i,s){this.http=i,this.router=s}getActivities(i){let s=localStorage.getItem("auth-token"),e=new FormData;return e.append("wsfunction","core_course_get_contents"),e.append("wstoken",s),e.append("moodlewsrestformat","json"),e.append("courseid",i),this.http.post(`${y.N.baseURL}/webservice/rest/server.php`,e).pipe((0,f.w)(c=>(0,x.of)(c)))}getBengaliDetailsActivity(i){let s=localStorage.getItem("auth-token"),e=new FormData;return e.append("wsfunction","modcustomfields_details_by_courseid_and_cmid"),e.append("wstoken",s),e.append("moodlewsrestformat","json"),e.append("cmid",i),this.http.post(`${y.N.baseURL}/webservice/rest/server.php`,e).pipe((0,f.w)(c=>(0,x.of)(c)))}}return o.\u0275fac=function(i){return new(i||o)(t.LFG(w.eN),t.LFG(d.F0))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var L=n(658),g=n(3416);const Z=["myVideo"];function F(o,a){1&o&&(t.TgZ(0,"div",4),t._UZ(1,"div",5),t.qZA())}function N(o,a){if(1&o){const i=t.EpF();t.TgZ(0,"div",6)(1,"div")(2,"h1",7),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"div",8)(6,"button",9),t.NdJ("click",function(){t.CHM(i);const e=t.oxw();return t.KtG(e.goToCourse())}),t._uU(7),t.ALo(8,"translate"),t.qZA()()()()}2&o&&(t.xp6(3),t.hij(" ",t.lcZ(4,2,"YOU ARE NOT ENROLLED IN THIS COURSE")," "),t.xp6(4),t.hij(" ",t.lcZ(8,4,"Course Details")," "))}function P(o,a){if(1&o){const i=t.EpF();t.TgZ(0,"button",25),t.NdJ("click",function(){t.CHM(i);const e=t.oxw(2);return t.KtG(e.goPrevActivity())}),t._UZ(1,"mat-icon",26),t.TgZ(2,"span"),t._uU(3),t.ALo(4,"translate"),t.qZA()()}2&o&&(t.xp6(1),t.Q6J("svgIcon","mat_solid:keyboard_arrow_left"),t.xp6(2),t.Oqu(t.lcZ(4,2,"Previous")))}function M(o,a){1&o&&t._UZ(0,"button")}function S(o,a){if(1&o){const i=t.EpF();t.TgZ(0,"button",25),t.NdJ("click",function(){t.CHM(i);const e=t.oxw(2);return t.KtG(e.goNextActivity())}),t.TgZ(1,"span"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t._UZ(4,"mat-icon",26),t.qZA()}2&o&&(t.xp6(2),t.hij("",t.lcZ(3,2,"Next")," "),t.xp6(2),t.Q6J("svgIcon","mat_solid:keyboard_arrow_right"))}function O(o,a){if(1&o){const i=t.EpF();t.TgZ(0,"button",27),t.NdJ("click",function(){t.CHM(i);const e=t.oxw(2);return t.KtG(e.getCertificate())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&o&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Download Certificate")," "))}function j(o,a){1&o&&(t.TgZ(0,"button",28),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.Q6J("disabled",!0),t.xp6(1),t.hij(" ",t.lcZ(2,2,"Download Certificate")," "))}function k(o,a){if(1&o){const i=t.EpF();t.TgZ(0,"div",10)(1,"div",11)(2,"div",12)(3,"video",13,14),t.NdJ("loadedmetadata",function(e){t.CHM(i);const c=t.oxw();return t.KtG(c.onVideoMetadataLoaded(e))})("loadstart",function(){t.CHM(i);const e=t.oxw();return t.KtG(e.loadPreviousTime())})("timeupdate",function(){t.CHM(i);const e=t.oxw();return t.KtG(e.saveCurrentTime())}),t._UZ(5,"source",15),t.qZA()(),t.TgZ(6,"div",16)(7,"div",17),t.YNc(8,P,5,4,"button",18),t.YNc(9,M,1,0,"button",19),t.YNc(10,S,5,4,"button",20),t.YNc(11,O,3,3,"button",21),t.YNc(12,j,3,4,"button",22),t.qZA()(),t.TgZ(13,"div",23)(14,"p",24),t._uU(15),t.qZA()()()()}if(2&o){const i=t.oxw();t.xp6(5),t.Q6J("src",i.video_src,t.LSH),t.xp6(3),t.Q6J("ngIf",-1!=i.prevActivityID&&"customcert"!=i.prevActivityType),t.xp6(1),t.Q6J("ngIf",-1==i.prevActivityID),t.xp6(1),t.Q6J("ngIf",-1!=i.nextActivityID&&"customcert"!=i.nextActivityType&&1==i.activityDone),t.xp6(1),t.Q6J("ngIf",-1!=i.nextActivityID&&"customcert"==i.nextActivityType&&i.certificateAvailable),t.xp6(1),t.Q6J("ngIf",-1!=i.nextActivityID&&"customcert"==i.nextActivityType&&!i.certificateAvailable),t.xp6(3),t.hij(" ",i.videoName," ")}}const J=[{path:"",component:(()=>{class o{constructor(i,s,e,c,l,u,v,r,E,Q){this.sanitize=i,this.route=s,this._router=e,this.getCertificateApi=c,this.autoDoneApi=l,this.getActivityStatus=u,this._authService=v,this.activityApi=r,this.activityCompletion=E,this.translateService=Q,this.certificateAvailable=!1,this.cert_url="",this.loading=!0,this.prevActivityID=-1,this.nextActivityID=-1,this.prevActivityType="",this.nextActivityType="",this.prevActivityFormat="",this.nextActivityFormat="",this.activityDone=!1,this.enrolled=!0,this.currentVideoTime=0,this.doneBtnDisabled=!0,this.videoFinished=!1,this.activityInfo={}}ngOnInit(){this.route.queryParams.subscribe(i=>{this.enrolled=!0,this.videoFound=!1,this.activityDone=!1,this.currentActivity={},this.topicId=i.topic,this.activityID=i.activity,this.video_src="",this.prevActivityID=-1,this.nextActivityID=-1,this.loading=!0,this.courseID=i.course,this.userID=localStorage.getItem("user-id"),this.wsToken=localStorage.getItem("auth-token"),this.saveCurrentActivity(this.userID,this.courseID,this.activityID,this.topicId),this.getActivityStatus.getActivityStatus(this.courseID,this.userID).subscribe(s=>{if(s.exception||s.errorcode)return this.enrolled=!1,this.loading=!1,this.videoFound=!1,this._authService.signOut(),void this._router.navigate(["login"]);let e=s.statuses;this.enrolled=!1;for(let c of e)c.cmid==this.activityID&&(this.activityInfo=c,this.enrolled=!0,1==c.isautomatic?(this.isAutomatic=!0,1==c.state?(this.activityDone=!0,this.doneBtnDisabled=!0,this.testCertificate(),this.activityCompletion.updateActivityStatus(Number(this.activityID))):this.activityDone=!1):1==c.state?(this.activityDone=!0,this.doneBtnDisabled=!1,this.testCertificate(),this.activityCompletion.updateActivityStatus(Number(this.activityID))):this.activityDone=!1);this.loading=!1}),this.activityApi.getActivities(this.courseID).subscribe(s=>{const e=s.slice(1),c=e.find(u=>u.id==this.topicId),l=e.findIndex(u=>u.id==this.topicId);this.activityList=c.modules,this.activityList&&this.activityList.forEach((u,v)=>{if(u.id==this.activityID){if(this.loading=!1,this.videoFound=!0,"bn"===this.translateService.getDefaultLang()?this.activityApi.getBengaliDetailsActivity(u.id).subscribe(r=>{this.videoName=r.results[0].category_details[0].field_value}):this.videoName=u.name,this.fileURL=u.contents[0].fileurl,this.fileURL=this.fileURL+"&token="+this.wsToken,this.video_src=this.sanitize.bypassSecurityTrustResourceUrl(this.fileURL),this.myVideo&&this.myVideo.nativeElement.load(),v>0)this.activityList[v-1].id&&(this.prevActivityID=this.activityList[v-1].id,this.prevInstanceID=this.activityList[v-1].instance,this.prevActivityType=this.activityList[v-1].modname,"resource"==this.prevActivityType&&(this.prevActivityFormat=this.activityList[v-1].contentsinfo.mimetypes));else if(l-1>=0&&e[l-1].modules.length>0){const r=e[l-1].modules;this.prevTopicId=e[l-1].id,this.prevActivityID=r[r.length-1].id,this.prevInstanceID=r[r.length-1].instance,this.prevActivityType=r[r.length-1].modname,"resource"==this.prevActivityType&&(this.prevActivityFormat=r[r.length-1].contentsinfo.mimetypes)}if(v+1<this.activityList.length)this.activityList[v+1].id&&(this.nextActivityID=this.activityList[v+1].id,this.instanceID=this.activityList[v+1].instance,this.nextActivityType=this.activityList[v+1].modname,"resource"==this.nextActivityType&&(this.nextActivityFormat=this.activityList[v+1].contentsinfo.mimetypes));else if(l+1<e.length&&e[l+1].modules.length>0){const r=e[l+1].modules;this.nextTopicId=e[l+1].id,this.nextActivityID=r[0].id,this.instanceID=r[0].instance,this.nextActivityType=r[0].modname,"resource"==this.nextActivityType&&(this.nextActivityFormat=r[0].contentsinfo.mimetypes)}}})})})}ngAfterViewInit(){this.timer=setInterval(()=>{this.myVideo&&this.myVideo.nativeElement&&this.myVideo.nativeElement.currentTime&&(this.currentVideoTime=this.myVideo.nativeElement.currentTime,this.currentVideoTime>=this.marginalVideoTime&&(this.activityDone=!0,this.autoDone(),this.activityCompletion.updateActivityStatus(Number(this.activityID))))},1e3)}ngOnDestroy(){clearInterval(this.timer)}autoDone(){this.autoDoneApi.autoDone(this.activityInfo.instance).subscribe(i=>{this.activityDone=!0,this.testCertificate(),this.doneBtnDisabled=!0,this.activityCompletion.updateActivityStatus(Number(this.activityID))})}onVideoMetadataLoaded(i){this.videoDuration=this.myVideo.nativeElement.duration,this.marginalVideoTime=75*this.videoDuration/100}getCertificate(){window.open(this.cert_url,"_blank")}testCertificate(){this.getCertificateApi.getCertificate(this.courseID,this.userID).subscribe(i=>{i.url?(this.certificateAvailable=!0,this.cert_url=i.url):this.certificateAvailable=!1})}onLoadMetadata(i){this.videoDuration=this.myVideo.nativeElement.duration}goNextActivity(){-1===this.activityList.findIndex(i=>i.id==this.nextActivityID)&&(this.topicId=this.nextTopicId),"quiz"==this.nextActivityType?this._router.navigate([`course-activity/${this.courseID}/quiz`],{queryParams:{id:this.instanceID,course:this.courseID,activity:this.nextActivityID,topic:this.topicId}}):"zoom"==this.nextActivityType?this._router.navigate([`course-activity/${this.courseID}/meeting`],{queryParams:{course:this.courseID,activity:this.nextActivityID,topic:this.topicId}}):"videoplus"===this.nextActivityType?this._router.navigate([`course-activity/${this.courseID}/video-pdf`],{queryParams:{course:this.courseID,activity:this.nextActivityID,topic:this.topicId}}):"coursefeedback"==this.nextActivityType?this._router.navigate([`course-activity/${this.courseID}/feedback`],{queryParams:{course:this.courseID,activity:this.nextActivityID,topic:this.topicId}}):"application/pdf"==this.nextActivityFormat?this._router.navigate([`course-activity/${this.courseID}/pdf`],{queryParams:{course:this.courseID,activity:this.nextActivityID,topic:this.topicId}}):("video/mp4"==this.nextActivityFormat||"video/webm"==this.nextActivityFormat||"video/mov"==this.nextActivityFormat)&&this._router.navigate([`course-activity/${this.courseID}/video`],{queryParams:{course:this.courseID,activity:this.nextActivityID,topic:this.topicId}})}goPrevActivity(){-1===this.activityList.findIndex(i=>i.id==this.prevActivityID)&&(this.topicId=this.prevTopicId),"quiz"==this.prevActivityType?this._router.navigate([`course-activity/${this.courseID}/quiz`],{queryParams:{id:this.prevInstanceID,course:this.courseID,activity:this.prevActivityID,topic:this.topicId}}):"zoom"==this.prevActivityType?this._router.navigate([`course-activity/${this.courseID}/meeting`],{queryParams:{course:this.courseID,activity:this.prevActivityID,topic:this.topicId}}):"videoplus"===this.prevActivityType?this._router.navigate([`course-activity/${this.courseID}/video-pdf`],{queryParams:{course:this.courseID,activity:this.prevActivityID,topic:this.topicId}}):"application/pdf"==this.prevActivityFormat?this._router.navigate([`course-activity/${this.courseID}/pdf`],{queryParams:{course:this.courseID,activity:this.prevActivityID,topic:this.topicId}}):("video/mp4"==this.prevActivityFormat||"video/webm"==this.prevActivityFormat||"video/mov"==this.prevActivityFormat)&&this._router.navigate([`course-activity/${this.courseID}/video`],{queryParams:{course:this.courseID,activity:this.prevActivityID,topic:this.topicId}})}saveCurrentTime(){this.route.queryParams.subscribe(i=>{localStorage.setItem(JSON.stringify(i),this.myVideo.nativeElement.currentTime)})}loadPreviousTime(){this.route.queryParams.subscribe(i=>{const s=Number(localStorage.getItem(JSON.stringify(i)));this.myVideo&&(this.myVideo.nativeElement.currentTime=s)})}saveCurrentActivity(i,s,e,c){const l={type:"video",activityId:e,topicId:c};localStorage.setItem(JSON.stringify({userId:i,courseId:s}),JSON.stringify(l))}}return o.\u0275fac=function(i){return new(i||o)(t.Y36(I.H7),t.Y36(d.gz),t.Y36(d.F0),t.Y36(D.G),t.Y36(_.F),t.Y36(T.o),t.Y36(C.e),t.Y36(V),t.Y36(L.B),t.Y36(g.sK))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-video-activity"]],viewQuery:function(i,s){if(1&i&&t.Gf(Z,5),2&i){let e;t.iGM(e=t.CRH())&&(s.myVideo=e.first)}},decls:4,vars:3,consts:[[1,"infxs:min-h-[400px]","md:min-h-screen"],["class","min-h-screen flex justify-center items-center",4,"ngIf"],["class","h-screen flex justify-center items-center",4,"ngIf"],["class","video-container lg:max-w-4xl xl:max-w-7xl pb-5 infxs:pt-5 md:pt-0 mx-auto",4,"ngIf"],[1,"min-h-screen","flex","justify-center","items-center"],[1,"loader"],[1,"h-screen","flex","justify-center","items-center"],[1,"text-center","text-vumi-orange","text-2xl","font-bold","lg:text-4xl"],[1,"flex","justify-center","mt-7"],["type","button",1,"button-vumi","infxs:text-base","sm:text-lg","infxs:w-30","infxs:h-8","sm:w-[140px]","sm:h-[38px]","text-white","bg-blue-700","hover:bg-blue-800","focus:outline-none","focus:ring-4","focus:ring-blue-300","font-medium","text-center","mr-2","mb-2","dark:bg-blue-600","dark:hover:bg-blue-700","dark:focus:ring-blue-800",3,"click"],[1,"video-container","lg:max-w-4xl","xl:max-w-7xl","pb-5","infxs:pt-5","md:pt-0","mx-auto"],[1,"max-w-[1000px]","mx-auto"],["id","video",1,"relative"],["controls","","controlsList","fullscreen nodownload noremoteplayback noplaybackrate foobar","preload","metadata","width","100%","data-setup",'{ "aspectRatio":"640:267", "playbackRates": [1, 1.5, 2] }',1,"mx-auto","mb-6","rounded",3,"loadedmetadata","loadstart","timeupdate"],["myVideo",""],["type","video/mp4",3,"src"],[1,"lg:max-w-4xl","xl:max-w-7xl","mb-6","mx-auto"],[1,"infxs:mx-0","xs:mx-15","sm:mx-18","md:mx-20","lg:mx-30","xl:mx-40","gap-2","flex","flex-row","justify-between","lg:mt-4","infxs:mt-4","lg:mb-4","infxs:mb-4"],["style","filter: drop-shadow(0px 4px 4px rgb(35, 6, 1,0.3))","class","button-vumi infxs:text-base sm:text-lg infxs:w-30 infxs:h-8 sm:w-[140px] sm:h-[38px] bg-vumi-orange text-white  font-bold  outline-none focus:outline-none mb-1 ease-linear transition-all duration-150","type","button",3,"click",4,"ngIf"],[4,"ngIf"],["style","filter: drop-shadow(0px 4px 4px rgb(35, 6, 1,0.3))","class","button-vumi infxs:text-base sm:text-lg infxs:w-30 infxs:h-8 sm:w-[140px] sm:h-[38px] bg-vumi-orange text-white font-bold  outline-none focus:outline-none mb-1 ease-linear transition-all duration-150","type","button",3,"click",4,"ngIf"],["class","infxs:px-2 button-vumi infxs:text-base sm:text-lg infxs:w-30 infxs:h-8 sm:w-[140px] sm:h-[38px] border border-vumi-blue bg-vumi-blue text-white font-bold outline-none focus:outline-none  mb-1 ease-linear transition-all duration-150","type","button",3,"click",4,"ngIf"],["class","infxs:px-2 text-base border border-gray-300 bg-gray-300 text-white font-bold outline-none focus:outline-none mb-1 ease-linear transition-all duration-150","type","button",3,"disabled",4,"ngIf"],[1,"mb-4"],[1,"text-left","text-[#121212]","font-semibold","lg:text-4xl","sm:text-5xl","infxs:text-3xl"],["type","button",1,"button-vumi","infxs:text-base","sm:text-lg","infxs:w-30","infxs:h-8","sm:w-[140px]","sm:h-[38px]","bg-vumi-orange","text-white","font-bold","outline-none","focus:outline-none","mb-1","ease-linear","transition-all","duration-150",2,"filter","drop-shadow(0px 4px 4px rgb(35, 6, 1,0.3))",3,"click"],["aria-hidden","false","aria-label","previous activity icon",1,"text-white","icon-size-7",3,"svgIcon"],["type","button",1,"infxs:px-2","button-vumi","infxs:text-base","sm:text-lg","infxs:w-30","infxs:h-8","sm:w-[140px]","sm:h-[38px]","border","border-vumi-blue","bg-vumi-blue","text-white","font-bold","outline-none","focus:outline-none","mb-1","ease-linear","transition-all","duration-150",3,"click"],["type","button",1,"infxs:px-2","text-base","border","border-gray-300","bg-gray-300","text-white","font-bold","outline-none","focus:outline-none","mb-1","ease-linear","transition-all","duration-150",3,"disabled"]],template:function(i,s){1&i&&(t.TgZ(0,"div",0),t.YNc(1,F,2,0,"div",1),t.YNc(2,N,9,6,"div",2),t.YNc(3,k,16,7,"div",3),t.qZA()),2&i&&(t.xp6(1),t.Q6J("ngIf",s.loading),t.xp6(1),t.Q6J("ngIf",!s.enrolled),t.xp6(1),t.Q6J("ngIf",s.videoFound&&s.enrolled))},dependencies:[p.O5,m.Hw,g.X$],styles:['.loader[_ngcontent-%COMP%]{border:14px solid #f3f3f3;border-top:8px solid #0e6eae;border-radius:50%;width:60px;height:60px;animation:spin .8s linear infinite}#play[_ngcontent-%COMP%]{top:50%!important;left:50%!important}.play-btn[_ngcontent-%COMP%]{width:50px;height:50px;border:hidden;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background-color:#000;border-radius:50%;overflow:hidden;cursor:pointer}.play-btn[_ngcontent-%COMP%]:before{content:"";position:absolute;top:11px;left:16px;width:0;height:0;border-top:15px solid transparent;border-left:25px solid white;border-bottom:15px solid transparent}.video-js[_ngcontent-%COMP%]   .vjs-control-bar[_ngcontent-%COMP%]   .vjs-time-control[_ngcontent-%COMP%], .video-js[_ngcontent-%COMP%]   .vjs-time-control.vjs-time-divider[_ngcontent-%COMP%], #myVideo[_ngcontent-%COMP%]   .vjs-time-control[_ngcontent-%COMP%], .video-js.vjs-default-skin[_ngcontent-%COMP%]   .vjs-time-control[_ngcontent-%COMP%]{display:hidden!important}']}),o})()}];var U=n(1056);let Y=(()=>{class o{}return o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[p.ez,A.AV,d.Bz.forChild(J),b.u5,m.Ps,U.m]}),o})()}}]);